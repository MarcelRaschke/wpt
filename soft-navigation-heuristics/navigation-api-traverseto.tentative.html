<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<title>Detect navigation.traverseTo()</title>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/resources/testdriver.js"></script>
<script src="/resources/testdriver-vendor.js"></script>
<script src="resources/soft-navigation-helper.js"></script>
</head>
<body>
  <main id=main>
    <div>
      <a id=link>Click me!</a>
    </div>
  </main>
  <script>
    let key;
    // Push state a couple of times
    (async () => {
      navigation.onnavigate = e => {
        e.intercept();
      };
      // Push a couple of navigation entries, so that we'd have a navigation entry to traverse to.
      await navigation.navigate("foobar.html").finished;
      // TODO(yoav): Is there a cleaner way to ensure that the navigation actually lands?
      await new Promise(r => setTimeout(r, 10));
      key = navigation.currentEntry.key;
      await navigation.navigate("another.html").committed;
    })();
    const link = document.getElementById("link");
    testSoftNavigation({
      addContent: () => {
        addTextToDivOnMain();
      },
      link: link,
      pushState: async () =>{
        await navigation.traverseTo(key).committed;
      },
      test: "`navigation.traverseTo()` properly works with SoftNavigationHeuristics"});
  </script>
</body>
</html>



